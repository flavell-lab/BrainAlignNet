# BrainAlignNet GFP controls

The purpose of running the GFP control is to examine the possible scenario that, despite the RFP images appearing well-aligned, the moving RFP images may be scrambled across multiple neuron locations in the warped moving RFP when applying the DDF generated by the network.

We provided four datasets in which freely-moving worms express both pan-neuronal NLS-mNeptune (analogous to pan-neuronal NLS-tagRFP) and eat-4::NLS-GFP, which we refer to as the RFP and GFP channels, respectively. In our scripts and on Dropbox, the GFP channel is designated as channel 1, and the RFP channel as channel 2.

The four datasets are tagged as follows: (1) `ALv4` or `2022-01-06-01`, (2) `ALv6` or `2022-03-30-01`, (3) `ALv7` or `2022-03-30-02`, and (4) `ALv8` or `2022-03-31-01`. These names are used interchangeably in our scripts and file names.

The script `run_gfp_control.py` takes as input the tag for one of the four datasets (i.e., `ALv4`, `ALv6`, `ALv7` or `ALv8`), the path to a model checkpoint, and the path to the modelâ€™s YAML configuration file. It also requires specifying the network version to label the output NCC scores correctly. The network versions include `full`, `nolabel`, `noreg`, `noimage`. For more details on these networks, please refer to our paper. Running the script generates a JSON file that contains the NCC scores of the fixed and warped moving images in both channels (GFP and RFP) for all registration problems, listed in the order of channel 1, then channel 2.

## find shared content
- All four datasets are shared on [Dropbox](https://www.dropbox.com/scl/fo/ealblchspq427pfmhtg7h/ABsPot7GnBiu04Xi-eKyJds/BrainAlignNet/GFP_data?dl=0&rlkey=1e6tseyuwd04rbj7wmn2n6ij7&subfolder_nav_tracking=1).
- All registration problems sampled from each of the four datasets can be found under the folder `resources`.
- Model checkpoints for all network versions can be found on [Dropbox](https://www.dropbox.com/scl/fo/ealblchspq427pfmhtg7h/AKpI9DpPLYjQZ-lkDhI2zYk/BrainAlignNet/model_weights?dl=0&rlkey=1e6tseyuwd04rbj7wmn2n6ij7&subfolder_nav_tracking=1).
- Model configuration files for all network versions can be found on [GitHub](https://github.com/flavell-lab/BrainAlignNet/tree/main/configs).

## try it out
```python
from run_gfp_control import register_all_swf360_problems

dataset = 'ALv4'
model_ckpt_path = '/data3/prj_register/full_network/save/ckpt-287'
model_config_path = '/data3/prj_register/full_network/config.yaml'
set_GPU(2)
register_all_swf360_problems(
    dataset,
    model_ckpt_path,
    model_config_path,
    network_version='full'
)
```
